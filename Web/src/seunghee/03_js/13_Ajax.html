<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>Ajax</title>
</head>
<body>
    <h1>Ajax</h1>

    <h2>Ajax 구현</h2>
    <!--
    1. XMLHttpRequest 객체 초기화
    2. 서버에 비동기 요청 보냄
    3. 서버에서 응답이 오면 처리함
    서버의 응답에 따라 처리할 절차를 콜백함수로 정의함
    마치 이벤트 함수와 비슷하게 작용
    readystatechange : 서버에서의 응답여부 확인 이벤트 속성
    readystate : 서버응답 속성
     0 : 초기화 되지 않음
     1 : 서버와 연결 성공
     2 : 서버와 요청 수락
     3 : 서버가 요청처리중
     4 : 서버가 요청처리완료 & 곧 응답예정
    status : HTTP 상태코드 - 요청 성공 여부 확인
     200 : 처리 완료, 응답 잘 받음
     404 : 처리 실패, 요청 데이터가 존재하지 않을 경우
     500 : 처리 실패, 서버상 코드의 오류
    responseText - 넘어온 응답을 어떤 형식으로 받을 것인지
    -->
    <p>ajax 통신결과 <span id = "msg1"></span></p>
    <script>
        let msg = document.getElementById('msg1');

        // XMLHttpRequest 객체 초기화
        let req = new XMLHttpRequest();

        req.onreadystatechange = function () {
            if (req.readyState == 4) { // 서버가 보낼 응답수취 여부
                if (req.status == 200) { // 처리 성공 여부
                    msg.innerHTML = req.responseText;
                } else {
                    msg.innerHTML = req.status;
                }
            } else {
                msg.innerHTML = req.readyState;
            }
        };

        // 비동기방식 요청을 생성한 후 서버로 보냄
        // open(요청방식, url, 비동기여부)
        req.open('get', 'hello.txt', true);
        req.send();
    </script>
    <hr>




    <h2>버튼방식으로 구현</h2>
    <p>ajax 통신결과 <span id = "msg2"></span></p>
    <div><button type="button" id="saybtn">인사말하기</button></div>
    <script>
        let saybtn = document.getElementById('saybtn');
        saybtn.addEventListener('click', sayHello);

        function sayHello() {
            let msg = document.getElementById('msg2');
            let req = new XMLHttpRequest();

            req.onreadystatechange = function () {
                if (req.readyState == 4) {
                    if (req.status == 200) {
                        msg.innerHTML = req.responseText;
                    } else {
                        msg.innerHTML = req.status;
                    }
                } else {
                    msg.innerHTML = req.readyState;
                }
            };

            req.open('get', 'hello.txt', true);
            req.send();
        }
    </script>
    
    
    <h2> Ajax </h2>
    <script>
	    function get() {
    		var req = new XMLHttpRequest();
    		req.onreadystatechange = function() {
    			if(req.readyState == 4 && req.status == 200) {
    				func();
    			}
    			
    		}
    		req.open('get', url, true)
    		req.send();
    	}
	    	

    </script>
</body>
</html>